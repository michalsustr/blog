

<!doctype html>
<html lang="en" class="no-js">
  <head>
    

<meta charset="utf-8">



<!-- begin SEO -->









<title>Protocol buffers - python tips - My blog</title>







<meta property="og:locale" content="en">
<meta property="og:site_name" content="My blog">
<meta property="og:title" content="Protocol buffers - python tips">


  <link rel="canonical" href="http://michal.sustr.sk/blog/python/protocol-buffers-python-tips/">
  <meta property="og:url" content="http://michal.sustr.sk/blog/python/protocol-buffers-python-tips/">



  <meta property="og:description" content="Protocol buffers (protobufs) are well known Google’s mechanism for a language-neutral, platform-neutral, extensible mean for serializing structured data.Basically, it’s exchange format that is smaller than JSON/XML/whatever because it is saved in binary. And you can use code generators to make it very simple to use it in different languages.To make it to work quickly, just get the binary release from official relases and put the protoc command to /usr/bin/protoc. Once you write your own .proto spec file, like the addressbook in examples you can compile it with$ protoc --python_out=. *.protoThe docs for how to create the .proto specs are well documented on their website, so no need to explain it here. Maybe just a few things to keep in mind when you write your protocol headers:Extending protobufs:- you must not change the tag numbers of any existing fields.- you must not add or delete any required fields.- you may delete optional or repeated fields.- you may add new optional or repeated fields but you must use fresh tag numbers (i.e. tag numbers that were never used in this protocol buffer, not even by deleted fields).Currently there are two active versions:  proto2  proto3The proto2 version is still actively supported, probably mainly because I find the proto3 kind of sucks :-) (one thing I didn’t like it doesn’t have support for default values. As it turns out, I’m not the only one who doesn’t like it but it has reasons ).In python I struggled for an hour to find a way how to create human readable .prototxt files. All you have to do is (extending the python examples add_person.py and list_people.p )# import thisfrom google.protobuf import text_format# and then use this to readtext_format.Parse(f.read(), address_book)# and this to writetext_format.MessageToString(address_book)Enjoy.">



  <meta name="twitter:site" content="@michal_sustr">
  <meta name="twitter:title" content="Protocol buffers - python tips">
  <meta name="twitter:description" content="Protocol buffers (protobufs) are well known Google’s mechanism for a language-neutral, platform-neutral, extensible mean for serializing structured data.Basically, it’s exchange format that is smaller than JSON/XML/whatever because it is saved in binary. And you can use code generators to make it very simple to use it in different languages.To make it to work quickly, just get the binary release from official relases and put the protoc command to /usr/bin/protoc. Once you write your own .proto spec file, like the addressbook in examples you can compile it with$ protoc --python_out=. *.protoThe docs for how to create the .proto specs are well documented on their website, so no need to explain it here. Maybe just a few things to keep in mind when you write your protocol headers:Extending protobufs:- you must not change the tag numbers of any existing fields.- you must not add or delete any required fields.- you may delete optional or repeated fields.- you may add new optional or repeated fields but you must use fresh tag numbers (i.e. tag numbers that were never used in this protocol buffer, not even by deleted fields).Currently there are two active versions:  proto2  proto3The proto2 version is still actively supported, probably mainly because I find the proto3 kind of sucks :-) (one thing I didn’t like it doesn’t have support for default values. As it turns out, I’m not the only one who doesn’t like it but it has reasons ).In python I struggled for an hour to find a way how to create human readable .prototxt files. All you have to do is (extending the python examples add_person.py and list_people.p )# import thisfrom google.protobuf import text_format# and then use this to readtext_format.Parse(f.read(), address_book)# and this to writetext_format.MessageToString(address_book)Enjoy.">
  <meta name="twitter:url" content="http://michal.sustr.sk/python/protocol-buffers-python-tips/">

  
    <meta name="twitter:card" content="summary">
    
  

  



  

  





  <meta property="og:type" content="article">
  <meta property="article:published_time" content="2016-07-21T00:00:00+02:00">








  <script type="application/ld+json">
    {
      "@context" : "http://schema.org",
      "@type" : "Person",
      "name" : "Michal Šustr",
      "url" : "http://michal.sustr.sk/blog",
      "sameAs" : null
    }
  </script>






<!-- end SEO -->


<link href="http://michal.sustr.sk/blog/feed.xml" type="application/atom+xml" rel="alternate" title="My blog Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="http://michal.sustr.sk/blog/assets/css/main.css">

<meta http-equiv="cleartype" content="on">
    <!-- start custom head snippets -->
<script type="text/javascript"
    src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

<!-- insert favicons. use http://realfavicongenerator.net/ -->

<!-- end custom head snippets -->
  </head>

  <body>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->
    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <button><div class="navicon"></div></button>
        <ul class="visible-links">
          <li class="masthead__menu-item masthead__menu-item--lg"><a href="http://michal.sustr.sk/blog/">My blog</a></li>
          
            
            <li class="masthead__menu-item"><a href="http://michal.sustr.sk">Main page</a></li>
          
        </ul>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>

    





<div id="main" role="main">
  


  <div class="sidebar sticky">
  



<div itemscope itemtype="http://schema.org/Person">

  <div class="author__avatar">
    
    	<img src="http://michal.sustr.sk/blog/images/bio-photo.jpg" alt="Michal Šustr">
    
  </div>

  <div class="author__content">
    <h3 class="author__name">Michal Šustr</h3>
    <p class="author__bio"><p>A soul between research and engineering.</p><p>Artificial Intelligence / Machine Learning.</p></p>
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li><i class="fa fa-fw fa-map-marker" aria-hidden="true"></i> Prague, Czech republic</li>
      
      
        <li><a href="http://michal.sustr.sk"><i class="fa fa-fw fa-chain" aria-hidden="true"></i> Website</a></li>
      
      
      
      
        <li><a href="https://twitter.com/michal_sustr"><i class="fa fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
      
      
        <li><a href="https://www.facebook.com/sustr"><i class="fa fa-fw fa-facebook-square" aria-hidden="true"></i> Facebook</a></li>
      
      
      
      
      
      
      
      
        <li><a href="https://github.com/michalsustr"><i class="fa fa-fw fa-github" aria-hidden="true"></i> Github</a></li>
      
      
      
      
      
      
      
      
      
      
      
      
      
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="Protocol buffers - python tips">
    <meta itemprop="description" content="Protocol buffers (protobufs) are well known Google’s mechanism for a language-neutral, platform-neutral, extensible mean for serializing structured data.Basically, it’s exchange format that is smaller than JSON/XML/whatever because it is saved in binary. And you can use code generators to make it very simple to use it in different languages.To make it to work quickly, just get the binary release from official relases and put the protoc command to /usr/bin/protoc. Once you write your own .proto spec file, like the addressbook in examples you can compile it with$ protoc --python_out=. *.protoThe docs for how to create the .proto specs are well documented on their website, so no need to explain it here. Maybe just a few things to keep in mind when you write your protocol headers:Extending protobufs:- you must not change the tag numbers of any existing fields.- you must not add or delete any required fields.- you may delete optional or repeated fields.- you may add new optional or repeated fields but you must use fresh tag numbers (i.e. tag numbers that were never used in this protocol buffer, not even by deleted fields).Currently there are two active versions:  proto2  proto3The proto2 version is still actively supported, probably mainly because I find the proto3 kind of sucks :-) (one thing I didn’t like it doesn’t have support for default values. As it turns out, I’m not the only one who doesn’t like it but it has reasons ).In python I struggled for an hour to find a way how to create human readable .prototxt files. All you have to do is (extending the python examples add_person.py and list_people.p )# import thisfrom google.protobuf import text_format# and then use this to readtext_format.Parse(f.read(), address_book)# and this to writetext_format.MessageToString(address_book)Enjoy.">
    <meta itemprop="datePublished" content="July 21, 2016">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 class="page__title" itemprop="headline">Protocol buffers - python tips
</h1>
          
            <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 

This article takes

  
	  1 minute to read
	
</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        <p><a href="https://developers.google.com/protocol-buffers/">Protocol buffers</a> (protobufs) are well known Google’s mechanism for a language-neutral, platform-neutral, extensible mean for serializing structured data.</p>

<p>Basically, it’s exchange format that is smaller than JSON/XML/whatever because it is saved in binary. And you can use code generators to make it very simple to use it in different languages.</p>

<p>To make it to work quickly, just get the binary release from <a href="https://github.com/google/protobuf/releases">official relases</a> and put the <code class="highlighter-rouge">protoc</code> command to <code class="highlighter-rouge">/usr/bin/protoc</code>. Once you write your own .proto spec file, like <a href="https://github.com/google/protobuf/blob/master/examples/addressbook.proto">the addressbook in examples</a> you can compile it with</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ protoc --python_out=. *.proto
</code></pre>
</div>

<p>The docs for how to create the .proto specs are well documented on their website, so no need to explain it here. Maybe just a few things to keep in mind when you write your protocol headers:</p>

<p>Extending protobufs:
- you must not change the tag numbers of any existing fields.
- you must not add or delete any required fields.
- you may delete optional or repeated fields.
- you may add new optional or repeated fields but you must use fresh tag numbers (i.e. tag numbers that were never used in this protocol buffer, not even by deleted fields).</p>

<p>Currently there are two active versions:</p>

<ul>
  <li><a href="https://developers.google.com/protocol-buffers/docs/proto2">proto2</a></li>
  <li><a href="https://developers.google.com/protocol-buffers/docs/proto2">proto3</a></li>
</ul>

<p>The <strong>proto2</strong> version is still actively supported, probably mainly because I find the <strong>proto3</strong> kind of <em>sucks</em> :-) (one thing I didn’t like it doesn’t have support for <em>default values</em>. As it turns out, <a href="https://groups.google.com/forum/#!topic/protobuf/ZRpcfmeGK6s">I’m not the only one who doesn’t like it</a> but <a href="https://stackoverflow.com/questions/33222551/why-are-there-no-custom-default-values-in-proto3">it has reasons</a> ).</p>

<p>In python I struggled for an hour to find a way how to create human readable .prototxt files. All you have to do is (extending the python examples <a href="https://github.com/google/protobuf/blob/master/examples/add_person.py">add_person.py</a> and <a href="https://github.com/google/protobuf/blob/master/examples/list_people.py">list_people.p</a> )</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># import this</span>
<span class="kn">from</span> <span class="nn">google.protobuf</span> <span class="kn">import</span> <span class="n">text_format</span>
<span class="c"># and then use this to read</span>
<span class="n">text_format</span><span class="o">.</span><span class="n">Parse</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">address_book</span><span class="p">)</span>
<span class="c"># and this to write</span>
<span class="n">text_format</span><span class="o">.</span><span class="n">MessageToString</span><span class="p">(</span><span class="n">address_book</span><span class="p">)</span>
</code></pre>
</div>

<p>Enjoy.</p>


        
      </section>

      <footer class="page__meta">
        
        




  






  
  
  

  <p class="page__taxonomy">
    <strong><i class="fa fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="http://michal.sustr.sk/blog/categories/python" class="page__taxonomy-item" rel="tag">python</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i> Updated:</strong> <time datetime="2016-07-21T00:00:00+02:00">July 21, 2016</time></p>
        
      </footer>

      

<section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=http://michal.sustr.sk/blog/python/protocol-buffers-python-tips/" class="btn btn--twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http://michal.sustr.sk/blog/python/protocol-buffers-python-tips/" class="btn btn--facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://plus.google.com/share?url=http://michal.sustr.sk/blog/python/protocol-buffers-python-tips/" class="btn btn--google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http://michal.sustr.sk/blog/python/protocol-buffers-python-tips/" class="btn btn--linkedin" title="Share on LinkedIn"><i class="fa fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>

      


  <nav class="pagination">
    
      <a href="http://michal.sustr.sk/blog/python/sphinx-python-tips/" class="pagination--pager" title="Sphinx - python tips
">Previous</a>
    
    
      <a href="http://michal.sustr.sk/blog/why-i-think-schmidhubers-conclusion-of-non-interfering-ai-is-wrong/" class="pagination--pager" title="Why I think Schmidhuber’s conclusion of non-interfering AI is wrong
">Next</a>
    
  </nav>

    </div>

    
      

<div class="page__comments">
  
  
    <h4 class="page__comments-title">Leave a Comment</h4>
    <section id="disqus_thread"></section>
  
</div>
    
  </article>

  
  
    <div class="page__related">
      
        <h4 class="page__related-title">You May Also Enjoy</h4>
      
      <div class="grid__wrapper">
        
          





<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        
          <a href="http://michal.sustr.sk/blog/python/outlier-analysis/" rel="permalink">
        

          <img src=
            
              "http://michal.sustr.sk/blog/images/teaser.jpg"
            
            alt="">
        </a>
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="http://michal.sustr.sk/blog/python/outlier-analysis/" rel="permalink">Outlier analysis using PCA
</a>
      
    </h2>

    <p class="archive__item-excerpt" itemprop="description">Recently I tried to detect outliers in some high-dimensional data to find out more about the dataset. It is quite a common task - you have a dataset at your ...</p>
  </article>
</div>
        
          





<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        
          <a href="http://michal.sustr.sk/blog/why-i-think-schmidhubers-conclusion-of-non-interfering-ai-is-wrong/" rel="permalink">
        

          <img src=
            
              "http://michal.sustr.sk/blog/images/teaser.jpg"
            
            alt="">
        </a>
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="http://michal.sustr.sk/blog/why-i-think-schmidhubers-conclusion-of-non-interfering-ai-is-wrong/" rel="permalink">Why I think Schmidhuber’s conclusion of non-interfering AI is wrong
</a>
      
    </h2>

    <p class="archive__item-excerpt" itemprop="description">I really enjoyed watching Prof. Jürgen Schmidhuber’s talk about future of AI. The topic of AI becoming Terminator-style is an evergreen and as a person who a...</p>
  </article>
</div>
        
          





<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        
          <a href="http://michal.sustr.sk/blog/python/sphinx-python-tips/" rel="permalink">
        

          <img src=
            
              "http://michal.sustr.sk/blog/images/teaser.jpg"
            
            alt="">
        </a>
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="http://michal.sustr.sk/blog/python/sphinx-python-tips/" rel="permalink">Sphinx - python tips
</a>
      
    </h2>

    <p class="archive__item-excerpt" itemprop="description">I recently started to educate myself more in Python. I decided that from time to time I’m going to put here some tips and tricks, things that I’ve come acros...</p>
  </article>
</div>
        
          





<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        
          <a href="http://michal.sustr.sk/blog/neural%20networks/human-learning-is-waaay-more-efficient-in-power-consumption-for-now/" rel="permalink">
        

          <img src=
            
              "http://michal.sustr.sk/blog/images/teaser.jpg"
            
            alt="">
        </a>
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="http://michal.sustr.sk/blog/neural%20networks/human-learning-is-waaay-more-efficient-in-power-consumption-for-now/" rel="permalink">Human learning is way more efficient in power consumption… for now.
</a>
      
    </h2>

    <p class="archive__item-excerpt" itemprop="description">When I was eating dinner a simple thought occurred to me: is machine learning more power efficient than human learning… from scratch?

A neural network calle...</p>
  </article>
</div>
        
      </div>
    </div>
  
</div>

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        

<div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    
    
      <li><a href="https://twitter.com/michal_sustr"><i class="fa fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
    
    
      <li><a href="https://facebook.com/sustr"><i class="fa fa-fw fa-facebook-square" aria-hidden="true"></i> Facebook</a></li>
    
    
      <li><a href="http://github.com/michalsustr"><i class="fa fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
    
    
    <li><a href="http://michal.sustr.sk/blog/feed.xml"><i class="fa fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2016 Michal Šustr. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>
      </footer>
    </div>

    <script src="http://michal.sustr.sk/blog/assets/js/main.min.js"></script>




  <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-18710589-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>






  
  <script type="text/javascript">
  	/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  	var disqus_shortname = 'michalsustr';

  	/* * * DON'T EDIT BELOW THIS LINE * * */
  	(function() {
  		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  	})();

  	/* * * DON'T EDIT BELOW THIS LINE * * */
  	(function () {
  		var s = document.createElement('script'); s.async = true;
  		s.type = 'text/javascript';
  		s.src = '//' + disqus_shortname + '.disqus.com/count.js';
  		(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
  	}());
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>






  </body>
</html>
